<!DOCTYPE html>
<html lang="en">
{{ partial "head" . }}
<body class="lh-copy near-black bg-white lato">
  {{ block "header" . }}
    {{ partial "nav" . }}
  {{ end }}

  <div class="page-wrap overflow-x-hidden">
    <div id="search-box">
      <!-- SearchBox widget will appear here -->
    </div>

    <div id="algolia">
      <!-- Hits widget will appear here -->
    </div>

  {{ block "main" . }}
  {{ end }}

  {{ block "footer" . }}
    {{ partial "footer-black" . }}
  {{ end }}

  </div>

  <script>
    $('a[href*="#"]')
      // Remove links that don't actually link to anything
      .not('[href="#"]')
      .not('[href="#0"]')
      .click(function(event) {
        // On-page links
        if (
          location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
          && 
          location.hostname == this.hostname
        ) {
          // Figure out element to scroll to
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
          // Does a scroll target exist?
          if (target.length) {
            // Only prevent default if animation is actually gonna happen
            event.preventDefault();
            $('html, body').animate({
              scrollTop: target.offset().top //- $('#home').height()
            }, 1000, function() {
              // Callback after animation
              // Must change focus!
              var $target = $(target);
              //$target.focus();
              if ($target.is(":focus")) { // Checking if the target was focused
                return false;
              } else {
                $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
                //$target.focus(); // Set focus again
              };
            });
          }
        }
      });
  </script>

  <!--Netlify CMS Identity-->
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>

  <script>
    const search = instantsearch({
      appId: 'GKE6Y4S63I',
      apiKey: '3723d8a93a52b50655f1771c329cc61c',
      indexName: 'lpfa',
      routing: true
    });

    search.addWidget(
      instantsearch.widgets.searchBox({
        container: '#search-box',
        placeholder: 'Search for products'
      })
    );

    search.addWidget(
      instantsearch.widgets.hits({
        container: '#algolia'
      })
    );

    search.start();    
  </script>
  
</body>
</html>
